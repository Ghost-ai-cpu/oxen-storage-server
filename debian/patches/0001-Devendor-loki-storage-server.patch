From: Jason Rhinelander <jason@imaginary.ca>
Date: Tue, 16 Jul 2019 16:08:10 -0300
Subject: Devendor loki-storage-server

---
 httpserver/CMakeLists.txt | 15 ++++-----------
 1 file changed, 4 insertions(+), 11 deletions(-)

diff --git a/httpserver/CMakeLists.txt b/httpserver/CMakeLists.txt
index 5900db7..10aac93 100644
--- a/httpserver/CMakeLists.txt
+++ b/httpserver/CMakeLists.txt
@@ -18,6 +18,9 @@ add_library(httpserver_lib STATIC
     client_rpc_endpoints.cpp
     )
 
+set(JSON_MultipleHeaders ON CACHE BOOL "") # Allows multi-header nlohmann use
+add_subdirectory(../vendors/nlohmann_json nlohmann_json)
+
 # TODO: enable more warnings!
 target_compile_options(httpserver_lib PRIVATE -Wall -Werror)
 
@@ -45,17 +48,7 @@ set_target_properties(httpserver PROPERTIES OUTPUT_NAME ${BIN_NAME})
 target_link_libraries(httpserver PRIVATE httpserver_lib)
 install(TARGETS httpserver DESTINATION bin)
 # Build Info
-find_package(Git)
-if(GIT_FOUND)
-    execute_process(
-        COMMAND
-            git rev-parse --short HEAD
-        OUTPUT_VARIABLE
-            SHORT_HASH
-        OUTPUT_STRIP_TRAILING_WHITESPACE)
-else()
-    set(SHORT_HASH "unknown")
-endif()
+set(SHORT_HASH "deb-${OXENSS_VERSION_TAG}")
 string(TIMESTAMP BUILD_TIME UTC)
 message(STATUS "using git commit hash ${SHORT_HASH}")
 message(STATUS "using UTC build time ${BUILD_TIME}")
